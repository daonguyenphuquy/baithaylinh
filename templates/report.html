<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Báo cáo điểm danh - Hệ thống điểm danh khuôn mặt</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Hệ thống điểm danh sinh viên</h1>
            <p>Sử dụng công nghệ nhận dạng khuôn mặt</p>
        </header>

        <nav>
            <ul>
                <li><a href="/"><i class="fas fa-home"></i> Trang chủ</a></li>
                <li><a href="/register"><i class="fas fa-user-plus"></i> Đăng ký sinh viên</a></li>
                <li><a href="/attendance"><i class="fas fa-camera"></i> Điểm danh</a></li>
                <li><a href="/report"><i class="fas fa-chart-bar"></i> Báo cáo</a></li>
            </ul>
        </nav>

        <main>
            <h2><i class="fas fa-chart-bar"></i> Báo cáo điểm danh</h2>

            <div class="filter-container">
                <form class="filter-form" action="/report" method="get">
                    <label for="date-filter">Lọc theo ngày:</label>
                    <select name="date" id="date-filter" class="date-select">
                        <option value="all" {% if not selected_date %}selected{% endif %}>Tất cả ngày</option>
                        {% for date in all_dates %}
                        <option value="{{ date }}" {% if selected_date == date %}selected{% endif %}>{{ date }}</option>
                        {% endfor %}
                    </select>
                    <input type="submit" value="Lọc" class="btn btn-primary filter-btn">
                </form>

                <form id="search-form">
                    <input type="text" id="student-search" name="search" placeholder="Tìm kiếm theo tên hoặc mã SV..."
                           value="{{ search_query or '' }}">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search"></i> Tìm kiếm
                    </button>
                </form>
            </div>

            <div class="buttons-container">
                <button id="export-csv" class="btn btn-secondary">
                    <i class="fas fa-file-csv"></i> Xuất CSV
                </button>
                <button id="print-report" class="btn btn-secondary">
                    <i class="fas fa-print"></i> In báo cáo
                </button>
                <button id="backup-data" class="btn btn-primary">
                    <i class="fas fa-download"></i> Sao lưu dữ liệu
                </button>
                <button id="clear-data" class="btn btn-danger">
                    <i class="fas fa-trash"></i> Xóa dữ liệu
                </button>
            </div>

            <div class="report-table-container">
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Mã SV</th>
                            <th>Họ và tên</th>
                            <th>Lớp</th>
                            <th>Ngày</th>
                            <th>Thời gian</th>
                            <th>Trạng thái</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if attendance_records %}
                            {% for record in attendance_records %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ record.id }}</td>
                                <td>{{ record.name }}</td>
                                <td>{{ record.class }}</td>
                                <td>{{ record.date }}</td>
                                <td>{{ record.time }}</td>
                                <td class="status-cell"><span class="status-present">Có mặt</span></td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="7" class="no-data">
                                    {% if error %}
                                        {{ error }}
                                    {% else %}
                                        Không có dữ liệu điểm danh nào!
                                    {% endif %}
                                </td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>

            <div class="report-summary">
                <div class="summary-card">
                    <h3>Thống kê</h3>
                    <div class="summary-info">
                        <p><strong>Tổng số sinh viên đã điểm danh:</strong> {{ attendance_records|length }}</p>
                        <p><strong>Ngày:</strong> {{ selected_date or 'Tất cả ngày' }}</p>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>&copy; Designed by Dao Nguyen Phu Quy aka P3achnguynx</p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>